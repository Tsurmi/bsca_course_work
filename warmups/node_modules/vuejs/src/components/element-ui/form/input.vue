<template>
    <el-form-item ref="input"
        v-bind:label="computedConfigs.label"
        v-bind:prop="computedConfigs.name"
        v-bind:rules="computedConfigs.rules">
        <template slot="label">
            <slot name="label">
                {{ computedConfigs.label + '&nbsp;' }}
            </slot>
        </template>
        <slot name="input">
            <el-radio-group
                v-model="inputValue"
                v-bind:disabled="computedConfigs.disabled"
                v-if="computedConfigs.type === 'radio'">
                <el-radio class="radio"
                    v-for="(each, eachi) in computedConfigs.datasource"
                    v-bind:key="eachi"
                    v-bind:name="computedConfigs.name"
                    v-bind:label="each[computedConfigs.valueKey]"
                    v-bind:disabled="each.disabled">
                    {{ each[computedConfigs.labelKey] }}
                </el-radio>
            </el-radio-group>
            <el-checkbox-group
                v-model="inputValue"
                v-bind:disabled="computedConfigs.disabled"
                v-bind:min="computedConfigs.min"
                v-bind:max="computedConfigs.max"
                v-else-if="computedConfigs.type === 'checkbox'">
                <el-checkbox
                    v-for="(each, eachi) in computedConfigs.datasource"
                    v-bind:key="eachi"
                    v-bind:name="computedConfigs.name"
                    v-bind:label="each[computedConfigs.valueKey]"
                    v-bind:disabled="each.disabled">
                    {{ each[computedConfigs.labelKey] }}
                </el-checkbox>
            </el-checkbox-group>
            <el-select
                v-model="inputValue"
                v-bind:disabled="computedConfigs.disabled"
                v-bind:name="computedConfigs.name"
                v-bind:multiple="computedConfigs.multiple"
                v-bind:multiple-limit="computedConfigs.max"
                v-bind:clearable="computedConfigs.clearable"
                v-bind:loading="loading"
                v-else-if="computedConfigs.type === 'select'">
                <el-option
                    v-for="(each, eachi) in computedConfigs.datasource"
                    v-bind:key="eachi"
                    v-bind:label="each[computedConfigs.labelKey]"
                    v-bind:value="each[computedConfigs.valueKey]"
                    v-bind:disabled="each.disabled">
                </el-option>
            </el-select>
            <el-input
                v-bind:type="computedConfigs.type"
                v-bind:name="computedConfigs.name"
                v-bind:rows="computedConfigs.rows"
                v-model="inputValue"
                v-else
            ></el-input>
        </slot>
    </el-form-item>
</template>

<script>
    import Vue from 'vue';
    import Element from 'element-ui';

    Vue.use(Element);

    export default {
        name: 'nftn-el-input',
        props: {
            label: {
                type: String
            },
            type: {
                type: String
            },
            name: {
                type: String
            },
            configs: {
                type: Object,
                default () { return {}; }
            },
            value: { // v-model
                type: [Number, String, Array, Object]
            },
            rules: {
                type: Array,
                default: null
            },
            disabled: {
                type: Boolean,
                default: false
            },
            // 特殊选项
            datasource: { // type="radio | checkbox | select"
                type: Array
            },
            labelKey: { // type="radio | checkbox | select"
                type: String,
                default: 'name'
            },
            valueKey: { // type="radio | checkbox | select"
                type: String,
                default: 'value'
            },
            rows: { // type='textarea'
                type: Number
            },
            min: { // type='checkbox'
                type: Number
            },
            max: { // type='checkbox | select'
                type: Number
            },
            multiple: { // type='select'
                type: Boolean,
                default: false
            },
            clearable: { // type='select'
                type: Boolean,
                default: true
            }
        }, // props {}
        computed: {
            computedConfigs () {
                let configs = Object.assign({
                    label: this.label,
                    type: this.type || 'text',
                    name: this.name,
                    rules: this.rules,
                    disabled: this.disabled,
                    datasource: this.datasource,
                    labelKey: this.labelKey,
                    valueKey: this.valueKey,
                    rows: this.rows,
                    min: this.min,
                    max: this.max,
                    multiple: this.multiple,
                    clearable: this.clearable
                }, this.configs);
                return configs;
            }
        }, // computed {}
        data () {
            return {
                loading: false,
                inputValue: this.value
            };
        }, // data ()
        watch: {
            inputValue (newValue, oldValue) {
                this.$emit('input', newValue);
            },
            value (newValue, oldValue) {
                if (newValue !== oldValue) {
                    // 由 radio 分开放在两个地方的时候引起数据不响应
                    this.inputValue = null;
                    this.inputValue = newValue;
                }
            }
        }, // watch {}
        created () {
        },
        mounted () {
        }
    };
</script>
