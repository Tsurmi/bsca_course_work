<template>
    <div class="nftn-el-grid">
        <el-row
            ref="rows"
            v-for="(row, rowi) in cRows"
            v-bind:key="'row:' + rowi"
            v-bind:gutter="row.gap">
            <el-col
                v-for="(col, coli) in row.cols"
                v-bind:key="'col:' + rowi + '-' + coli"
                v-bind:span="col.span"
                v-bind:offset="col.offset"
                v-bind:xs="col.xs"
                v-bind:sm="col.sm"
                v-bind:md="col.md"
                v-bind:lg="col.lg">
                <div class="nftn-el-grid-content">
                    <slot v-bind:name="'grid-' + rowi + '-' + coli"></slot>
                </div>
            </el-col>
        </el-row>
    </div>
</template>

<script>
    import Vue from 'vue';
    import Element from 'element-ui';

    Vue.use(Element);

    require('element-ui/lib/theme-default/index.css');

    export default {
        name: 'nftn-el-grid',
        props: {
            rows: {
                type: Array,
                default () {
                    return [[24]];
                }
            },
            grap: {
                type: Number,
                default: 0
            },
            graps: {
                type: [Array, Object],
                default () {
                    return [];
                }
            },
            configs: {
                type: [Object, Array],
                default () {
                    return {};
                }
            }
        },
        methods: {
            getRows () {
                let configs = {
                    rows: this.configs.rows || this.rows || [[24]],
                    gap: this.configs.gap || this.gap || 0,
                    gaps: this.configs.gaps || this.gaps || []
                };

                if (this.configs instanceof Array) {
                    configs.rows = configs;
                }

                let rows = [];
                configs.rows.forEach((configRow, rowi) => {
                    let row = {
                        cols: [],
                        gap: configs.gaps[rowi] >= 0 ? configs.gaps[rowi] : configs.gap
                    };
                    let cols = configRow.cols instanceof Array ? configRow.cols : configRow;
                    cols.forEach((configCol, coli) => {
                        let col = {
                            span: typeof configCol === 'number' ? configCol : 24,
                            offset: 0
                        };
                        if (typeof configCol === 'object' && !(configCol instanceof Array)) {
                            col = Object.assign({}, col, configCol);
                        }

                        row.cols.push(col);
                    });
                    rows.push(row);
                });
                return rows;
            },
            setStyles () {
                (this.$refs.rows || []).forEach((refRow, index) => {
                    refRow.$el.style.height = 'auto';
                    refRow.$el.style.height = refRow.$el.clientHeight + 'px';
                });
            }
        },
        computed: {
            cRows () {
                return this.getRows();
            }
        },
        mounted () {
            this.setStyles();
        },
        updated () {
            this.setStyles();
        }
    };
</script>

<style>
    .nftn-el-grid {
        overflow: hidden;
    }
</style>
